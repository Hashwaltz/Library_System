{% extends "admin/admin_base.html" %}

{% block title %}Admin Dashboard - NC Library{% endblock %}
{% block header %}Dashboard{% endblock %}

{% block content %}
<div class="space-y-6">

  <!-- Top Metrics Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
    <!-- Total Patrons -->
    <div class="bg-white rounded-xl shadow p-6 flex items-center justify-between hover:shadow-xl transition">
      <div>
        <p class="text-gray-500 font-medium">Total Patrons</p>
        <h2 class="text-2xl font-bold text-blue-700">{{ total_users }}</h2>
        <p class="text-green-500 text-sm mt-1">+3.5% from last month</p>
      </div>
      <div class="bg-blue-100 p-3 rounded-full text-blue-700">
        <i class="fas fa-users fa-lg"></i>
      </div>
    </div>

    <!-- Total Books -->
    <div class="bg-white rounded-xl shadow p-6 flex items-center justify-between hover:shadow-xl transition">
      <div>
        <p class="text-gray-500 font-medium">Total Books</p>
        <h2 class="text-2xl font-bold text-green-600">{{ total_books }}</h2>
        <p class="text-green-500 text-sm mt-1">+4.2% from last month</p>
      </div>
      <div class="bg-green-100 p-3 rounded-full text-green-600">
        <i class="fas fa-book fa-lg"></i>
      </div>
    </div>

    <!-- Borrowed Books -->
    <div class="bg-white rounded-xl shadow p-6 flex items-center justify-between hover:shadow-xl transition">
      <div>
        <p class="text-gray-500 font-medium">Borrowed Books</p>
        <h2 class="text-2xl font-bold text-yellow-600">{{ total_borrowed }}</h2>
        <p class="text-green-500 text-sm mt-1">+1.8% from last month</p>
      </div>
      <div class="bg-yellow-100 p-3 rounded-full text-yellow-600">
        <i class="fas fa-book-reader fa-lg"></i>
      </div>
    </div>

    <!-- Active Members -->
    <div class="bg-white rounded-xl shadow p-6 flex items-center justify-between hover:shadow-xl transition">
      <div>
        <p class="text-gray-500 font-medium">Active Members</p>
        <h2 class="text-2xl font-bold text-purple-600">{{ active_members }}</h2>
        <p class="text-green-500 text-sm mt-1">+2.5% from last month</p>
      </div>
      <div class="bg-purple-100 p-3 rounded-full text-purple-600">
        <i class="fas fa-user-check fa-lg"></i>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Monthly Borrowed Books Bar Chart -->
    <div class="bg-white rounded-xl shadow p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Monthly Borrowed Books</h3>
      {% if monthly_borrowed|length > 0 %}
        <canvas id="borrowedBarChart" class="w-full h-64"></canvas>
      {% else %}
        <p class="text-gray-500 text-center py-16">No data available</p>
      {% endif %}
    </div>

    <!-- Book Status Donut Chart -->
    <div class="bg-white rounded-xl shadow p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Book Status Distribution</h3>
      {% if book_status_counts|length > 0 %}
        <canvas id="bookStatusDonutChart" class="w-full h-64"></canvas>
      {% else %}
        <p class="text-gray-500 text-center py-16">No data available</p>
      {% endif %}
    </div>
  </div>

  <!-- Secondary Widgets: Reminders & Notes -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Reminders -->
    <div class="bg-white rounded-xl shadow p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Reminders</h3>
      <ul class="list-disc list-inside text-gray-700 space-y-2">
        <li>Check overdue books daily.</li>
        <li>Approve new user registrations.</li>
        <li>Update library catalog weekly.</li>
        <li>Review borrowed books activity.</li>
      </ul>
    </div>

    <!-- Notes -->
    <div class="bg-white rounded-xl shadow p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Notes</h3>
      <p class="text-gray-700">Use this section to add internal admin notes or reminders for upcoming events, maintenance, or announcements.</p>
    </div>
  </div>

  <!-- Top Borrowed Books Table -->
  <div class="bg-white rounded-xl shadow p-6">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Top Borrowed Books</h3>
    {% if top_borrowed_books|length > 0 %}
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left font-medium text-gray-700">Book Title</th>
              <th class="px-4 py-2 text-left font-medium text-gray-700">Author</th>
              <th class="px-4 py-2 text-center font-medium text-gray-700">Times Borrowed</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            {% for book in top_borrowed_books %}
            <tr>
              <td class="px-4 py-2">{{ book.title }}</td>
              <td class="px-4 py-2">{{ book.author }}</td>
              <td class="px-4 py-2 text-center font-semibold">{{ book.times_borrowed }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-gray-500 text-center py-8">No data available</p>
    {% endif %}
  </div>

</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Only render charts if data exists
  {% if monthly_borrowed|length > 0 %}
  const borrowedCtx = document.getElementById('borrowedBarChart').getContext('2d');
  new Chart(borrowedCtx, {
    type: 'bar',
    data: {
      labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
      datasets: [{
        label: 'Borrowed Books',
        data: {{ monthly_borrowed|tojson }},
        backgroundColor: 'rgba(30,58,138,0.6)',
        borderColor: 'rgba(30,58,138,1)',
        borderWidth: 2,
        hoverBackgroundColor: 'rgba(59,130,246,0.7)',
        hoverBorderColor: 'rgba(59,130,246,1)'
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true }, x: { grid: { display: false } } }
    }
  });
  {% endif %}

  {% if book_status_counts|length > 0 %}
  const statusCtx = document.getElementById('bookStatusDonutChart').getContext('2d');
  new Chart(statusCtx, {
    type: 'doughnut',
    data: {
      labels: ['BSCS', 'BEED', 'BSHM', 'BSED', 'ALUMNI', 'FACULTY'],
      datasets: [{
        data: {{ book_status_counts|tojson }},
        backgroundColor: ['#10B981','#3B82F6','#EF4444','#F59E0B','#8B5CF6','#06B6D4'],
        borderColor: ['#065F46','#1E40AF','#B91C1C','#B45309','#5B21B6','#0E7490'],
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'bottom', labels: { boxWidth: 20, padding: 15 } } },
      cutout: '60%'
    }
  });
  {% endif %}
</script>
{% endblock %}
