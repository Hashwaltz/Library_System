{% extends "admin/admin_base.html" %}

{% block title %}Archived Books{% endblock %}
{% block header %}Archived Books{% endblock %}

{% block content %}
<div class="col-span-full bg-white shadow-xl rounded-xl p-6 border-l-4 border-[#004080]">
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
    <h2 class="text-xl font-semibold text-[#004080]">Archived Books</h2>
    <a href="{{ url_for('admin.list_books') }}" class="bg-[#004080] text-white px-4 py-2 rounded-lg hover:bg-[#002244] flex items-center gap-2">
      <i class="fas fa-arrow-left"></i>
      <span>Back to Books</span>
    </a>
  </div>

  <!-- Search -->
  <div class="mb-4">
    <input
      type="text"
      id="searchInput"
      placeholder="Search archived books..."
      class="w-full md:w-1/3 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#004080]"
    />
  </div>

  <!-- Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200 rounded">
      <thead class="bg-[#004080] text-white">
        <tr>
          <th class="px-4 py-3 text-left text-sm font-semibold">Title</th>
          <th class="px-4 py-3 text-left text-sm font-semibold">Author</th>
          <th class="px-4 py-3 text-left text-sm font-semibold">Accession #</th>
          <th class="px-4 py-3 text-left text-sm font-semibold">Call #</th>
          <th class="px-4 py-3 text-left text-sm font-semibold">Section</th>
          <th class="px-4 py-3 text-left text-sm font-semibold">Subject</th>
          <th class="px-4 py-3 text-left text-sm font-semibold">Edition</th>
          <th class="px-4 py-3 text-left text-sm font-semibold">Publisher</th>
          <th class="px-4 py-3 text-left text-sm font-semibold">Year</th>
          <th class="px-4 py-3 text-center text-sm font-semibold">Actions</th>
        </tr>
      </thead>

      <tbody class="divide-y">
        {% for book in books %}
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-3 font-medium">{{ book.title }}</td>
          <td class="px-4 py-3">{{ book.author }}</td>
          <td class="px-4 py-3">{{ book.assecion_number }}</td>
          <td class="px-4 py-3">{{ book.call_number }}</td>
          <td class="px-4 py-3">{{ book.section.name if book.section else '-' }}</td>
          <td class="px-4 py-3">{{ book.subject_type.name if book.subject_type else '-' }}</td>
          <td class="px-4 py-3">{{ book.edition.name if book.edition else '-' }}</td>
          <td class="px-4 py-3">{{ book.publisher or '-' }}</td>
          <td class="px-4 py-3">{{ book.year_published or '-' }}</td>
          <td class="px-4 py-3 text-center">
            <form method="POST" action="{{ url_for('admin.restore_book', book_id=book.id) }}">
              <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-800 flex items-center gap-1">
                <i class="fas fa-undo"></i> Restore
              </button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="10" class="text-center py-6 text-gray-500">No archived books found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="mt-4 flex justify-center items-center space-x-2">
    {% if pagination.has_prev %}
    <a href="{{ url_for('admin.archived_books', page=pagination.prev_num) }}" class="px-3 py-1 bg-[#cbd5e1] rounded hover:bg-gray-300">Prev</a>
    {% else %}
    <span class="px-3 py-1 bg-gray-200 rounded text-gray-500">Prev</span>
    {% endif %}

    <span class="px-3 py-1 bg-[#e2e8f0] rounded">Page {{ pagination.page }} of {{ pagination.pages }}</span>

    {% if pagination.has_next %}
    <a href="{{ url_for('admin.archived_books', page=pagination.next_num) }}" class="px-3 py-1 bg-[#cbd5e1] rounded hover:bg-gray-300">Next</a>
    {% else %}
    <span class="px-3 py-1 bg-gray-200 rounded text-gray-500">Next</span>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const searchInput = document.getElementById("searchInput");
  const rows = Array.from(document.querySelectorAll("tbody tr"));
  const rowsPerPage = 10;
  let currentPage = 1;

  function showPage(page) {
    const searchValue = searchInput.value.toLowerCase();
    const filteredRows = rows.filter((row) => {
      if (row.querySelector("td[colspan]")) return false;
      const title = row.cells[0].textContent.toLowerCase();
      const author = row.cells[1].textContent.toLowerCase();
      const accession = row.cells[2].textContent.toLowerCase();
      return title.includes(searchValue) || author.includes(searchValue) || accession.includes(searchValue);
    });

    const totalPages = Math.ceil(filteredRows.length / rowsPerPage) || 1;
    if (page > totalPages) currentPage = totalPages;
    if (page < 1) currentPage = 1;

    rows.forEach((row) => (row.style.display = "none"));
    const start = (currentPage - 1) * rowsPerPage;
    const end = start + rowsPerPage;
    filteredRows.slice(start, end).forEach((row) => (row.style.display = ""));
  }

  searchInput.addEventListener("keyup", () => { currentPage = 1; showPage(currentPage); });
  showPage(currentPage);
</script>
{% endblock %}
